<?php
	
	$available = 'market-201387040_4823136,market-201387040_4901642,market-201387040_4823128,market-201387040_4823113,market-201387040_4823116,market-201387040_4823119,market-201387040_4823266,market-201387040_4823120,';
	
	function getBtn($label, $color, $payload = '') {
		return [
			'action' => [
				'type' => 'text',
				"payload" => json_encode($payload, JSON_UNESCAPED_UNICODE),
				'label' => $label
			],
			'color' => $color
		];
	}

	if (!isset($_REQUEST)) {
		return;
	}

	//–°—Ç—Ä–æ–∫–∞ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Callback API
	$confirmation_token = '';

	//–ö–ª—é—á –¥–æ—Å—Ç—É–ø–∞ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
	$token = '';

	//–ü–æ–ª—É—á–∞–µ–º –∏ –¥–µ–∫–æ–¥–∏—Ä—É–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
	$data = json_decode(file_get_contents('php://input'));

	//–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–æ–ª–µ "type"
	switch ($data->type) {
	//–ï—Å–ª–∏ —ç—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞...
	case 'confirmation':
	//...–æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
	echo $confirmation_token;
	break;

	//–ï—Å–ª–∏ —ç—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏...
	case 'message_new':
	//...–ø–æ–ª—É—á–∞–µ–º id –µ–≥–æ –∞–≤—Ç–æ—Ä–∞
	$user_id = $data->object->message->from_id;
	//–∑–∞—Ç–µ–º —Å –ø–æ–º–æ—â—å—é users.get –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ–± –∞–≤—Ç–æ—Ä–µ
	$user_info = json_decode(file_get_contents("https://api.vk.com/method/users.get?user_ids={$user_id}&access_token={$token}&v=5.130"));

	//–∏ –∏–∑–≤–ª–µ–∫–∞–µ–º –∏–∑ –æ—Ç–≤–µ—Ç–∞ –µ–≥–æ –∏–º—è
	$first_name = $user_info->response[0]->first_name;  //–ø–æ–ª—É—á–∞–µ–º –∏–º—è
	$last_name = $user_info->response[0]->last_name;  //–ø–æ–ª—É—á–∞–µ–º —Ñ–∞–º–∏–ª–∏—é
	
	$date_message = $data->object->message->date; 	//–ø–æ–ª—É—á–∞–µ–º –¥–∞—Ç—É —Å–æ–æ–±—â–µ–Ω–∏–µ
	$text = $data->object->message->text; //–ø–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
	$date_message_ok = date("d M Y H:i:s", $date_message); 
	$payload_message = $data->object->message->payload; // –ø–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç –∫–Ω–æ–ø–∫–∏
	$peer_id = $data->object->message->peer_id;
	
	$lowtext = mb_strtolower($text, 'UTF-8');
	//—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
	// $message = "
// –î–∞—Ç–∞: $date_message_ok
// –ò–º—è: $first_name
// –§–∞–º–∏–ª–∏—è: $last_name
// –ü—Ä–æ—Ñ–∏–ª—å: https://vk.com/id$user_id
// —Å–æ–æ–±—â–µ–Ω–∏–µ: $text
	// ";
	
	
	// try {
		// $time_record = date("d M Y H:i:s");
		// $file_name = "log_from_vk.log";
		// $f = fopen($file_name, "a");
		// flock($f, 2);
		// fwrite($f, "–∑–∞–ø–∏—Å–∞–Ω–æ –≤ –ª–æ–≥: $time_record\n$message");
		// fclose($f);
	// }
	
	// catch(Exception $e) {}
	
	
	if( $lowtext == '–ø—Ä–∏–≤–µ—Ç' or $lowtext == '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ'){
		$msg = "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π, {$first_name}! –Ø - –±–æ—Ç –ê–Ω—è, –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?üòä";
	}
	
	//–∫–ª–∞–≤–∞
	$kbd_1 = [
		'one_time' => false,
		'buttons' => [
			[
				getBtn("–ù–∞—á–∞—Ç—å", 'positive', 'start')		
			],
		]
	];
	
	$kbd = $kbd_1;

	$kbd_2 = [
		'one_time' => false,
		'buttons' => [
			[
				getBtn("–ü—Ä–∞–π—Å", 'positive', 'PRICE'),
				getBtn("–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏", 'default', 'CATEGORY')
			],
			
			[
				getBtn("–ù–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–∞", 'default', 'available'),
				getBtn("–ú–µ–Ω–µ–¥–∂–µ—Ä", 'default', 'HELP')
			],
			[
				getBtn("–û—Ç–∑—ã–≤", 'default', 'REPLY'),
				getBtn("–û –ù–∞—Å", 'default', 'ABOUT')
			],
			[
				getBtn("–î–æ—Å—Ç–∞–≤–∫–∞", 'default', 'SHIP'),
				getBtn("–•–∞–ª—è–≤–∞", 'default', 'bonus')
			],
		]
	];
	
	$kbd_3 = [
		'one_time' => false,
		'buttons' => [
			[
				getBtn("üí≥ –õ'–≠—Ç—É–∞–ª—å", 'default', 'letual'),
				getBtn("üí≥ –†–ò–í –ì–û–®", 'default', 'rivgosh')
			],
			[
				getBtn("üí≥ –õ–µ–Ω—Ç–∞", 'default', 'lenta'),
				getBtn("üí≥ –ü–∞–Ω–¥–æ—Ä–∞", 'default', 'pandora')
			],
			
			[
				getBtn("–ù–∞–∑–∞–¥", 'default', 'start'),
			],
		]
	];
	
	

	
	$carousew = [
		'type' => 'carousel',
		'elements' => [
				[
					'title' => 'Title',
					'description' => 'Description',
					'action' => [
							'type' => 'open_link',
							'link' => 'https://vk.com'
					],
					'photo_id' => '-109837093_457242809',
					'buttons' => [[
							'action' => [
									'type' => 'text',
									'label' => 'Label'
							]
					]]
				],
				[
					'title' => 'Title',
					'description' => 'Description',
					'action' => [
							'type' => 'open_link',
							'link' => 'https://vk.com'
					],
					'photo_id' => '-109837093_457242809',
					'buttons' => [[
							'action' => [
									'type' => 'text',
									'label' => 'Label'
							]
					]]
				],
				[
					'title' => 'Title',
					'description' => 'Description',
					'action' => [
							'type' => 'open_link',
							'link' => 'https://vk.com'
					],
					'photo_id' => '-109837093_457242809',
					'buttons' => [[
							'action' => [
									'type' => 'text',
									'label' => 'Label'
							]
					]]
				],
			]
	];
	
	// $jsondata = json_encode($payload_message, JSON_UNESCAPED_UNICODE);
	// file_put_contents('t.json', $jsondata);
	switch ($payload_message) {
		
		case "\"start\"" : 
				$msg = "{$first_name}, —á—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —É–∑–Ω–∞—Ç—å?üòä";
				$kbd = $kbd_2;
				break;
				
		case "\"PRICE\"" : 
				$msg = "–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –æ–±—Ä–∞—Ç–∏–ª–∏—Å—å –∫ –Ω–∞–º! –ú—ã –¥–∞–µ–º –≥–∞—Ä–∞–Ω—Ç–∏—é —Ü–µ–Ω—ã –∏ –∫–∞—á–µ—Å—Ç–≤–∞. –õ—É—á—à–µ –≤—ã –Ω–∏–≥–¥–µ –Ω–µ –Ω–∞–π–¥–µ—Ç–µüòä";
				$media = 'photo-201387040_457239317';
				$kbd = $kbd_2;
				break;
		
		case "\"CATEGORY\"" : 
				
				$request_params = array(
					'message' => "–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –æ–±—Ä–∞—Ç–∏–ª–∏—Å—å –∫ –Ω–∞–º! –ú—ã –¥–∞–µ–º –≥–∞—Ä–∞–Ω—Ç–∏—é —Ü–µ–Ω—ã –∏ –∫–∞—á–µ—Å—Ç–≤–∞. –õ—É—á—à–µ –≤—ã –Ω–∏–≥–¥–µ –Ω–µ –Ω–∞–π–¥–µ—Ç–µüòä –†–∞–∑–¥–µ–ª —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è",
					'peer_id' => $user_id,
					'access_token' => $token,
					'v' => '5.130',
					'random_id' => '0',
					'template' => json_encode($carousew, JSON_UNESCAPED_UNICODE)
				);

				$get_params = http_build_query($request_params);

				
				
				file_get_contents('https://api.vk.com/method/messages.send?'. $get_params);
				
				break;
				
		case "\"available\"" : 
				$media = $available;
				$msg = "–¢–æ–≤–∞—Ä—ã –≤ –Ω–∞–ª–∏—á–∏–∏, —Ç–∞–∫–∂–µ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä—ã –ø–æ–¥ –∑–∞–∫–∞–∑ –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞—à–µ–º—É –º–µ–Ω–µ–¥–∂–µ—Ä—É:)";
				$kbd = $kbd_2;
				break;	
				
		case "\"HELP\"" : 
				$msg = "–°–∫–æ—Ä–æ —Å –≤–∞–º–∏ —Å–≤—è–∂–µ—Ç—Å—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä, –æ–∂–∏–¥–∞–π—Ç–µ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞üòä";
				$kbd = $kbd_1;
				break;		
				
		case "\"REPLY\"" : 
				$msg = "–£ –Ω–∞—Å –æ—á–µ–Ω—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ  –≤–æ–ª–æ—Å—ã, –ø–æ—ç—Ç–æ–º—É –≥–∞—Ä–∞–Ω—Ç–∏—è 100% —á—Ç–æ –≤—Å–µ –¥–æ–≤–æ–ª—å–Ω—ãüòä";
				$media = "photo-201387040_457239222,photo-201387040_457239221,photo-201387040_457239223,photo-201387040_457239224,photo-201387040_457239229,photo-201387040_457239228,photo-201387040_457239226";
				$kbd = $kbd_2;
				break;		
				
		case "\"ABOUT\"" : 
				$media = "photo-201387040_457239231,photo-201387040_457239232,photo-201387040_457239233";
				$msg = "–ú—ã —Å–æ–±–∏—Ä–∞–µ–º –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –≤–æ–ª–æ—Å –≤ —Å—Ä–µ–∑–∞—Ö, –Ω–µ–æ–∫—Ä–∞—à–µ–Ω–Ω—ã–π - —Ç–µ–º–Ω—ã–π –∏ –æ–∫—Ä–∞—à–∏–≤–∞–µ–º —Ñ–∞–±—Ä–∏—á–Ω—ã–º –º–µ—Ç–æ–¥–æ–º –≤ –ª—é–±—ã–µ —Ü–≤–µ—Ç–∞. –ö—Ä–æ–º–µ —Ç–µ–º–Ω—ã—Ö –∏ –æ–∫—Ä–∞—à–µ–Ω–Ω—ã—Ö –≤—Å–µ–≥–¥–∞ –≤ –Ω–∞–ª–∏—á–∏–∏ —Å–µ–¥–æ–π –≤–æ–ª–æ—Å, –±–µ–ª–æ–µ —Å–µ–¥–æ–µ —Å—ã—Ä—å–µ.
				
–í–æ–ª–æ—Å—ã –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ, –º—è–≥–∫–∏–µ, —Ç–æ–Ω–∫–∏–µ, –∫–∞–∫ —Å–ª–∞–≤—è–Ω—Å–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ. –£ –Ω–∞—Å –Ω–µ—Ç –ø–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç—ã—Ö –≤–æ–ª–æ—Å, –Ω–µ—Ç —Å–∏–ª–∏–∫–æ–Ω–∞, –Ω–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –º–∞—Ö–∏–Ω–∞—Ü–∏–π —Å —á–µ–ª–∫–∞–º–∏, —Ä–µ–∑–∏–Ω–∫–∞–º–∏ –∏ –≤–µ—Å–æ–º. –ï—Å—Ç—å –∏ —Å–∏–Ω–≥–ª–¥—Ä–æ–Ω –∏ –¥–∞–±–ª–¥—Ä–æ–Ω - —Ö–≤–æ—Å—Ç—ã —Å –ø–ª–æ—Ç–Ω—ã–º–∏ –∫–æ–Ω—Ü–∞–º–∏. –í—Å–µ —á–µ—Å—Ç–Ω–æ –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ. –û–¥–∏–Ω —Ä–∞–∑ –Ω–∞ —Ç–µ—Å—Ç –≤—ã –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å 200-300 –≥—Ä–∞–º–º –æ–¥–Ω–æ–π –¥–ª–∏–Ω—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞ –ø–æ –æ–ø—Ç–æ–≤–æ–º—É –ø—Ä–∞–π—Å—É.

–í—Å–µ –ø—Ä–∞–π—Å—ã –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã —Ç–∞–∫–∂–µ –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç–µ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –ª—é–±—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ —Ü–µ–Ω—ã –≤ –≤–∞—Ç—Ü–∞–ø–µ –∏–ª–∏ –ø–æ email –∏ —Å–ª–µ–¥–∏—Ç—å –∑–∞ –Ω–∞–º–∏ 

–≤ –∏–Ω—Å—Ç–∞–≥—Ä–∞–º instagram.com/anya_onehair
–≤ —Ç–∏–∫—Ç–æ–∫–µ tiktok.com/@anya_onehair

–ë—É–¥–µ–º —Ä–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å –≤ —á–∏—Å–ª–µ –Ω–∞—à–∏—Ö –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –∏ –¥–æ–≤–æ–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ ;)

–ü–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –ø–æ –≤–∞—à–µ–º—É –∂–µ–ª–∞–Ω–∏—é –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ –≤–∞—à–µ–≥–æ –∑–∞–∫–∞–∑–∞, –µ—Å–ª–∏ –≤–¥—Ä—É–≥ –≤–∞—Å –Ω–µ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Ü–≤–µ—Ç –∏–ª–∏ –∫–∞—á–µ—Å—Ç–≤–æ –≤–µ—Ä–Ω–µ–º –¥–µ–Ω—å–≥–∏üòä";
				$kbd = $kbd_2;
				break;		
				
		case "\"SHIP\"" : 
				$msg = "–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –∫—É—Ä—å–µ—Ä—Å–∫–æ–π —Å–ª—É–∂–±—ã –°–¥–µ–∫ —Å –ú–æ—Å–∫–≤—ã, —Å—Ä–æ–∫ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –ø–æ—Å—ã–ª–æ–∫ –≤ –†–æ—Å—Å–∏—é –æ–∫–æ–ª–æ –Ω–µ–¥–µ–ª–∏. –•–æ–¥ –ø–æ—Å—ã–ª–æ–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –ø–æ —Ç—Ä–µ–∫–∏–Ω–≥-–∫–æ–¥—É. –í –≥–æ—Ä–æ–¥–µ –ò–∂–µ–≤—Å–∫ —Ç–æ–≤–∞—Ä –º–æ–∂–Ω–æ –∑–∞–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Å–∞–º–æ–≤—ã–≤–æ–∑üòä";
				$kbd = $kbd_2;
				break;		
				
		case "\"bonus\"" : 
				$msg = "üíé—Ä–∞–∑–¥–µ–ª –ø–æ–º–æ—â—å –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µüíé";
				$kbd = $kbd_3;
				break;		
				
		case "\"letual\"" : 
				$msg = "üí≥ –õ'–≠—Ç—É–∞–ª—å –ö–∞—Ä—Ç–∞ ";
				$media = 'photo-201387040_457239318';
				$kbd = $kbd_3;
				break;		
				
		case "\"rivgosh\"" : 
				$msg = "üí≥ –†–ò–í –ì–û–® –ö–∞—Ä—Ç–∞ ";
				$media = 'photo-201387040_457239319';
				$kbd = $kbd_3;
				break;	
				
		case "\"lenta\"" : 
				$msg = "üí≥ –õ–µ–Ω—Ç–∞ –ö–∞—Ä—Ç–∞ ";
				$media = 'photo-201387040_457239320';
				$kbd = $kbd_3;
				break;	
				
		case "\"pandora\"" : 
				$msg = "üí≥ PANDORA –ö–∞—Ä—Ç–∞ ";
				$media = 'photo-201387040_457239321';
				$kbd = $kbd_3;
				break;		
		
				
				
				
	}
	
	
	
	//–° –ø–æ–º–æ—â—å—é messages.send –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
	$request_params = array(
		'attachment' => $media,
		'message' => $msg,
		'peer_id' => $user_id,
		'access_token' => $token,
		'v' => '5.130',
		'random_id' => '0',
		'dont_parse_links' => '1',
		'keyboard' => json_encode($kbd, JSON_UNESCAPED_UNICODE)
	);

	$get_params = http_build_query($request_params);

	
	
	file_get_contents('https://api.vk.com/method/messages.send?'. $get_params);

	
	//–í–æ–∑–≤—Ä–∞—â–∞–µ–º "ok" —Å–µ—Ä–≤–µ—Ä—É Callback API

	echo('ok');

	break;

}
?>